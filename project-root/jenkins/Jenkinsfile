pipeline {
    agent {
        docker {
            image 'maven:3.9.5-openjdk-17'
            args '-v /var/run/docker.sock:/var/run/docker.sock -v /workspace:/workspace'
        }
    }

    stages {
        stage('Build') {
            steps {
                script {
                    docker.image('maven:3.9.5-openjdk-17').inside('-v /var/run/docker.sock:/var/run/docker.sock -v /workspace:/workspace') {
                        // Verificar a vers√£o do Maven
                        sh 'mvn --version'

                        // Compilar e empacotar o projeto
                        sh 'cd /workspace && mvn package -Dmaven.test.skip=true'
                    }
                }
            }
        }
        stage('Test') {
            steps {
                script {
                    docker.image('maven:3.9.5-openjdk-17').inside('-v /var/run/docker.sock:/var/run/docker.sock -v /workspace:/workspace') {
                        sh '''#!/bin/bash
                            curl -H "Authorization: Bearer ${JWT_TOKEN}" \
                            -X POST https://api.example.com/test
                        '''
                        
                        // Executar os testes
                        sh 'cd /workspace && mvn test'
                    }
                }
            }
        }
    }
}